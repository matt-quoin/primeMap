<html>
  <head>
    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.2.1.min.js"></script>
    <script src="libraries/d3.v4.min.js"></script>
    <script src="libraries/d3-geo-projection.v1.min.js"></script>
    <script src="libraries/topojson.v2.min.js"></script>
    <script src="countryParse.js"></script>
    <script src="csvParse2.js"></script>
    <script src="csvParse1.js"></script>
    <script src="/worldMap.js"></script>
    <link rel="stylesheet" type="text/css" href="compiled_for_upload/interactive_map.css">
  <head>
  <body onresize=window.location.reload()>
    <div id="map-container"></div>
    <div id="sliderdiv">
      <input id="year-slider" type="range" min="1975" max="2013" step="0.01" value="2013"/>
    </div>
    <div id="slider-year"></div>
    <div id="side-bar-container"></div>
    <div id="close-bg" class="hide"></div>
    <div id="graph-slideout-button">
      <p>More Details</p>
      <div class="arrow bounce"></div>
    </div>
    <div id="graph-container"></div>
    <script>
      (function() {
        var initialize = true;
        var dataServerPath = "test/";
        var actualMediaFileNames = '["gdpPerCap.csv", "internetUsers.csv", "perCapitaFoodSupply.csv", "poverty.csv", "refugeeData2013.csv", "undernourishment.csv", "interactive_map.css"]';

        actualMediaFileNames = JSON.parse(actualMediaFileNames);
        var rawMediaFileNames = ["internetUsers.csv", "perCapitaFoodSupply.csv", "undernourishment.csv", "poverty.csv", "gdpPerCap.csv"];
        var rawMapFile = "refugeeData2013.csv";
        var mediaFileMap = {};
        var actualMapFile;
        var index, value, result;
        for (var i = 0; i < rawMediaFileNames.length; i += 1) {
          var originialFileName = rawMediaFileNames[i].slice(0, -4)
          for (var key in actualMediaFileNames) {
            var value = actualMediaFileNames[key];

            if (value.includes(originialFileName)) {
              mediaFileMap[rawMediaFileNames[i]] = value;
              break;
            }
            actualMapFile
          }
        }

        for (var key in actualMediaFileNames) {
          var value = actualMediaFileNames[key];

          if (value.includes("refugeeData2013")) {
            actualMapFile = value;
            break;
          }
        }

        buildMap(dataServerPath, mediaFileMap, function() {
          if(initialize){
            initialize = false; //makes countries clickable from the start
            updateYear(2013);
            csvParse(dataServerPath, updateMap, actualMapFile, 2013, 0);
          }
        });

        d3.select("#year-slider").on("input", function(){ //updates year in right corner
          var value = Math.round(this.value);
          updateYear(value);
        });

        d3.select("#year-slider").on("mouseup", function(){ //updates actual map
          var value = Math.round(this.value);
          csvParse(dataServerPath, updateMap, actualMapFile, value, 0);
        });

        document.getElementById("graph-slideout-button").addEventListener("click", function() {
          document.getElementById("close-bg").classList.toggle("hide");
          document.getElementById("graph-slideout-button").classList.toggle("expand-graph");
          document.getElementById("graph-container").classList.toggle("expand-graph");
        });
        document.getElementById("close-bg").addEventListener("click", function() {
          document.getElementById("close-bg").classList.add("hide");
          document.getElementById("graph-slideout-button").classList.remove("expand-graph");
          document.getElementById("graph-container").classList.remove("expand-graph");
        });
      })();
    </script>
  </body>
</html>
